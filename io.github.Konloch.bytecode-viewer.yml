app-id: io.github.Konloch.bytecode-viewer

runtime: org.freedesktop.Platform
runtime-version: '23.08'

sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk8

command: run.sh
finish-args:
  #- --share=ipc
  - --socket=x11
  #- --device=all
  - --share=network
  - --filesystem=home

modules:
  - name: openjdk
    build-options:
      no-debuginfo: true
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk8/install.sh

  - name: application
    build-options:
      no-debuginfo: true
    buildsystem: simple
    build-commands:
      - install -d "$FLATPAK_DEST/bin"
      - install -Dpm744 run.sh "$FLATPAK_DEST/bin/run.sh"
      - install -Dpm644 bytecodeviewer.jar "$FLATPAK_DEST/bin/bytecodeviewer.jar"
      - install -Dm644  bytecode-viewer.desktop "$FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop"
      - install -Dm644  icon.png "$FLATPAK_DEST/share/icons/hicolor/32x32/apps/$FLATPAK_ID.png"

      - tar -xf dbeaver.tar.gz --one-top-level=dbeaver_unpack
      - rm -rf dbeaver.tar.gz
      - cp -r dbeaver_unpack/dbeaver /app
      - install -d /app/clients/bin
      #- install -Dm644 io.dbeaver.DBeaverCommunity.appdata.xml /app/share/metainfo/io.dbeaver.DBeaverCommunity.appdata.xml
      - for icon_size in 16 32 48 64 128 256 512; do install -d /app/share/icons/hicolor/${icon_size}x${icon_size}/apps;
        install -m644 icon_${icon_size}x${icon_size}.png /app/share/icons/hicolor/${icon_size}x${icon_size}/apps/io.dbeaver.DBeaverCommunity.png;
        done
    sources:

      - type: file
        path: run.sh

      - type: file
        path: bytecode-viewer.desktop

      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_16x16.png
        sha256: 357982b7fe66bb5a7d809629c1b957d25b73605b12060bc31bde9d701221c377
      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_32x32.png
        sha256: f411294a4f8c2b610cf6283e488d5a70142af6ca56c377eeb2ed66a4d6497bc3
      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_48x48.png
        sha256: d7c31b2a7932c67a7bb742445166852b4cf5d0ae713e3cf539b82e3115f41cd0
      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_64x64.png
        sha256: 6f7663dd9954c72fcac3354b5fef2230b3fb92aea700d65a65c54ce2d61da1d3
      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_128x128.png
        sha256: c6c4401560e91ea617b249191262c903f9fa387125c8d2343c40f696a6fa6265
      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_256x256.png
        sha256: 787b48c17d099ea028df136cdec1096c4a87963c87adf2da9e3da85e3afb95df
      - type: file
        url: https://raw.githubusercontent.com/dbeaver/dbeaver/devel/product/community/icons-sources/icon_512x512.png
        sha256: f8ab6c3cf98cc239a050334313c06eed78b7e5703427bc22410e66dc211ddb43
      #- type: file
      #  path: io.dbeaver.DBeaverCommunity.appdata.xml
      
      - type: file
        dest-filename: icon.png
        url: https://raw.githubusercontent.com/Konloch/bytecode-viewer/master/BCV%20Icon.png
        sha256: 380fbc2d958fc5e0c3f7c05b21de83e3d7e956b00ab476439f893f1d10a61a3e
      
      - type: file
        only-arches:
            - x86_64
        dest-filename: bytecodeviewer.jar
        url: https://github.com/Konloch/bytecode-viewer/releases/download/v2.12/Bytecode-Viewer-2.12.jar
        sha256: dc5f6669409d7d0bbba40c735875a39960c1777f11bb13a1819bb12917808c5c
      
      - type: file
        dest-filename: dbeaver.tar.gz
        only-arches:
          - x86_64
        url: https://github.com/dbeaver/dbeaver/releases/download/24.1.0/dbeaver-ce-24.1.0-linux.gtk.x86_64-nojdk.tar.gz
        sha256: 709723528652a43f3b8f2e06188c4c8a7656e20c5165f7063b419d19419723a8
        x-checker-data:
          type: anitya
          project-id: 16276
          url-template: https://github.com/dbeaver/dbeaver/releases/download/$version/dbeaver-ce-$version-linux.gtk.x86_64-nojdk.tar.gz
